<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spotify Playlist Importer</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <h1 class="mt-5 mb-3">Import Your DJ Set List to Spotify</h1>
      <div class="mb-3">
        <button
          id="loginButton"
          class="btn btn-primary"
          onclick="loginToSpotify()"
        >
          Login with Spotify
        </button>
      </div>
      <div class="form-group">
        <label for="playlistName" id="playlistNameLabel">Playlist Name:</label>
        <input
          type="text"
          id="playlistName"
          class="form-control"
          placeholder="Enter playlist name"
        />
      </div>
      <div class="form-group">
        <textarea
          id="setList"
          class="form-control"
          rows="10"
          placeholder="Enter track names separated by newlines"
          style="display: none"
        ></textarea>
      </div>
      <button
        id="importButton"
        class="btn btn-success mt-2"
        onclick="importPlaylist()"
        style="display: none"
      >
        Import to Spotify
      </button>
      <button
        id="logoutButton"
        class="btn btn-secondary mt-2"
        onclick="logout()"
        style="display: none"
      >
        Logout
      </button>
    </div>

    <script src="./app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function loginToSpotify() {
        console.log("Redirecting to Spotify...");
        window.location.href = "/login";
      }

      function logout() {
        window.location.href = "/logout";
      }

      function updateUI(isLoggedIn) {
        const loginBtn = document.getElementById("loginButton");
        const logoutBtn = document.getElementById("logoutButton");
        const playlistName = document.getElementById("playlistName");
        const playlistNameLabel = document.getElementById("playlistNameLabel");
        const setList = document.getElementById("setList");
        const importBtn = document.getElementById("importButton");

        if (isLoggedIn) {
          loginBtn.style.display = "none";
          logoutBtn.style.display = "block";
          playlistName.style.display = "block";
          playlistNameLabel.style.display = "block";
          setList.style.display = "block";
          importBtn.style.display = "block";
        } else {
          loginBtn.style.display = "block";
          logoutBtn.style.display = "none";
          playlistName.style.display = "none";
          playlistNameLabel.style.display = "none";
          setList.style.display = "none";
          importBtn.style.display = "none";
        }
      }

      window.onload = async function () {
        const response = await fetch("/check-login");
        const result = await response.json();
        updateUI(result.isLoggedIn);
      };
    </script>
  </body>
</html>
